var app=angular.module("PersonalNotepad",["ngRoute"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"home.html",controller:"homeController"}).when("/edit/:id",{templateUrl:"edit.html",controller:"editController"}).when("/read/:id",{templateUrl:"read.html",controller:"readController"}).when("/login/",{templateUrl:"login.html",controller:"loginController"}).when("/register/",{templateUrl:"register.html",controller:"registerController"}).otherwise({redirectTo:"/"})}]),app.service("noteClientService",["$window","userFactory",function(e,t){function r(){var r=t.getCurrentUser();if(!r)throw"logged in User Not found";var n=r.userName;return stringifiedNotes=e.localStorage[n+"_notes"],stringifiedNotes?JSON.parse(e.localStorage[n+"_notes"]):[]}function n(r){var n=t.getCurrentUser();if(!n)throw"logged in User Not found";var o=n.userName;e.localStorage[o+"_notes"]=JSON.stringify(r)}this.load=r,this.store=n}]),app.service("noteServerService",["$http","$q","userFactory",function(e,t,r){function n(){var n=r.getCurrentUser();if(!n)return t.reject("logged in User Not found");var o=n.userName;return e.post("/note/getAll",{userName:o}).then(function(e){if("200"!=e.status)return t.reject(e.data);var r=e.data;return"success"!==r.status?t.reject(new Error(r.errorMessage)):r.notes})}function o(n){var o=r.getCurrentUser();if(!o)return t.reject("logged in User Not found");var i=o.userName;return e.post("/note/storeAll",{userName:i,notes:n}).then(function(e){if("200"!=e.status)return t.reject(e.data);var r=e.data;return"success"!==r.status?t.reject(new Error(r.errorMessage)):void 0})}this.load=n,this.store=o}]),app.service("noteService",["noteServerService","noteClientService",function(e,t){function r(){return e.load().then(function(e){return t.store(e),e},function(){return t.load()})}function n(r){return e.store(r).then(function(){t.store(r)},function(){t.store(r)})}this.load=r,this.store=n}]),app.factory("userFactory",["$http","$q","$window",function(e,t,r){function n(n,o){return e.post("/user/login",{userName:n,passWord:o}).then(function(e){if("200"!=e.status)return t.reject(e.data);var n=e.data;return"success"!==n.status?t.reject(n.errorMessage):void(r.sessionStorage.userData=JSON.stringify(n.userData))})}function o(){delete r.sessionStorage.userData}function i(r){return e.post("/user/register",r).then(function(e){if("200"!=e.status)return t.reject(e.data);var r=e.data;return"success"!==r.status?t.reject(new Error(r.errorMessage)):void 0})}function a(){var e=r.sessionStorage.userData;return e?JSON.parse(e):null}return{login:n,logout:o,register:i,getCurrentUser:a}}]),app.controller("editController",["$scope","$location","$routeParams","$window","noteClientService","noteService",function(e,t,r,n,o,i){var a=r.id,s=o.load();e.textNote=s[a],e.backToHome=function(){"read"==r.origin?t.url("/read/"+a):t.url("/")},e.save=function(){s[a]=e.textNote,i.store(s).then(function(){e.backToHome()},function(){e.backToHome()})},e.delete=function(){s.splice(a,1),i.store(s).then(function(){t.url("/")},function(){t.url("/")})}}]),app.controller("homeController",["$scope","$location","userFactory","$window","noteService",function(e,t,r,n,o){e.currentUser=r.getCurrentUser(),o.load().then(function(t){e.notes=t}),e.addNewNote=function(){e.notes.push(""),o.store(e.notes).then(function(){t.url("/edit/"+(e.notes.length-1))},function(){t.url("/edit/"+(e.notes.length-1))})},e.removeNote=function(t){e.notes.splice(t,1),o.store(e.notes)},e.editNote=function(e){t.url("/edit/"+e)},e.readNote=function(e){t.url("/read/"+e)},e.login=function(){t.url("/login")},e.logout=function(){r.logout(),e.currentUser=null},e.register=function(){t.url("/register")},e.storeNotes=function(){o.store(e.notes)}}]),app.controller("loginController",["$scope","$location","userFactory","$window",function(e,t,r,n){e.userName="",e.passWord="",e.doLogin=function(){var o=e.userName,i=e.passWord;r.login(o,i).then(function(){t.url("/")},function(t){n.alert(JSON.stringify(t,null,4)),e.passWord=void 0})},e.backToHome=function(){t.url("/")}}]),app.controller("readController",["$scope","$window","$location","$routeParams","noteClientService",function(e,t,r,n,o){var i=n.id,a=o.load();e.textNote=a[i],e.backToHome=function(){r.url("/")},e.goToEdit=function(){r.url("/edit/"+i+"?origin=read")}}]),app.controller("registerController",["$scope","$location","userFactory","$window",function(e,t,r,n){e.backToHome=function(){t.url("/")},e.doRegister=function(){var o=e.fullName,i=e.userName,a=e.passWord,s={userName:i,passWord:a,fullName:o};r.register(s).then(function(){n.alert("Registration Done!"),t.url("/login")},function(t){n.alert(JSON.stringify(t,null,4)),e.passWord=void 0,e.rePassWord=void 0})}}]),app.controller("TestController",["$scope","$window","$timeout",function(e,t,r){function n(){g.click()}function o(e){var t=p(g.files);l(t)}function i(e){v.className="dragover"===e.type&&e.path.indexOf(v)>=0?"drag-on":"",e.stopPropagation(),e.preventDefault()}function a(e){i(e)}function s(e){i(e)}function u(e){if(i(e),e.path.indexOf(v)>=0){var t=p(e.target.files||e.dataTransfer.files);l(t)}}function l(t){t=t.filter(function(t){return t.size>0&&""!=t.type&&0===e.selectedFiles.filter(function(e){return e.name===t.name&&e.size===t.size&&e.type===t.type&&e.lastModified===t.lastModified}).length}),t.forEach(function(t){if(t.type.match("image.*")){var r=new FileReader;r.onload=function(r){t.srcPreview=r.target.result,e.$$phase||e.$apply()},r.readAsDataURL(t)}}),t.forEach(c),e.selectedFiles=e.selectedFiles.concat(t),e.$$phase||e.$apply()}function c(t){t.status="Preparing";var r=new FormData;r.append(t.name,t);var n=new XMLHttpRequest;t.xhr=n,n.open("post","/upload",!0),n.upload.onprogress=function(r){r.lengthComputable&&(t.progress=Math.floor(r.loaded/r.total*100),e.$$phase||e.$apply())},n.onerror=function(r){t.status="Error",e.$$phase||e.$apply()},n.onabort=function(r){t.status="Aborted",e.$$phase||e.$apply()},n.onload=function(){t.status="Done!",e.$$phase||e.$apply()},t.status="Uploading",t.progress="0%",e.$$phase||e.$apply(),n.send(r)}function d(e){e.xhr.abort()}function f(t){d(t),r(function(){e.selectedFiles.splice(e.selectedFiles.indexOf(t),1)})}function p(e){return Array.apply(null,{length:e.length}).map(Number.call,Number).map(function(t){return e[t]})}e.selectFilesDialog=n,e.cancelUpload=d,e.removeFile=f,e.selectedFiles=[];var g=t.document.getElementById("input-file"),v=t.document.getElementById("drop-zone");g.addEventListener("change",o,!1),t.document.addEventListener("dragover",a,!1),t.document.addEventListener("dragleave",s,!1),t.document.addEventListener("drop",u,!1),e.$on("$destroy",function(){g.removeEventListener("change",o),t.document.removeEventListener("dragover",a),t.document.removeEventListener("dragleave",s),t.document.removeEventListener("drop",u)})}]);